<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Color Blocks</title>
    <style>
        .color-block {
            /* min-width: 150px; */
            width: 200px;
            /* Set minimum width so it doesn't get too small */
            padding: 20px 10px;
            /* Padding to space out content */
            margin: 20px;
            text-align: left;
            /* font-family: Arial, sans-serif; */
            /* border: 2px solid #ccc; */
            border: 4px solid whitesmoke;
            border-radius: 15px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s, opacity 0.5s, background-color 0.3s ease;
            opacity: 0;

            word-wrap: break-word;
            min-height: 150px;


        }


        .color-block:hover {
            transform: scale(1.05);
            box-shadow: 4px 4px 12px rgba(0, 0, 0, 0.3);
        }

        .color-description {
            margin-top: 10px;
        }

        .color-code {
            display: none;
        }

        .color-block:hover .color-code {
            display: block;
        }

        #buttonContainer {
            margin-bottom: 20px;
            text-align: center;
        }


        body {
            /* height: 100vh; */
            margin: 0;
            display: flex;
            flex-direction: column;
            /* Changed to column to stack vertically */
            align-items: center;
            background-color: #f7f7f7;
            padding-top: 150px;
            /* Space at the top for the button */
            background-color: beige;
            /* This sets the entire website's background color */


            font-family: 'Roboto', sans-serif;
            line-height: 1.3;
        }


        #generateColors {
            margin-bottom: 20px;
            background-color: coral;
            padding: 20px;
            border: 0;
            color: beige;
            font-size: x-large;
            font-weight: bold;
            cursor: pointer;
            /* Change the cursor to a hand when hovering over the button */
            transition: background-color 0.3s, transform 0.3s;
            /* For a smooth color and size transition on hover */
            border-radius: 5px;
            /* Add some rounded corners */
        }

        #generateColors:hover {
            background-color: darkred;
            /* Darken the button color on hover for a hover effect */
            transform: scale(1.05);
            /* Make the button slightly larger on hover for a hover effect */
        }


        #blocksContainer {
            /* min-height: 200px; */
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            /* Center the blocks horizontally */
            align-items: self-start;
            /* Center the blocks vertically */
            flex-grow: 1;
            /* Allow the container to grow and take up remaining space */
        }

        .color-name {
            color: beige;
            font-weight: bold;
            font-size: xxx-large;
        }

        .color-description {
            color: beige;
            text-align: justify
                /* font-weight: bold; */
                /* font-size: xxx-large; */
        }

        .color-content {
            display: flex;
            flex-direction: column;
            /* Stack children vertically */
            justify-content: center;
            /* Vertically center children */
            height: 100%;
            /* Take full height of the parent */
            transition: opacity 0.5s ease-in;
        }

        /* ... (rest of your CSS code) ... */

        .voila-style {
            text-align: center;
            margin-top: 20px;
            font-size: x-large;
            font-weight: bold;
            /* Background similar to your body */
            color: darkred;
            /* To harmonize with the hover effect of your button */
            padding: 10px 20px 40px;
            /* Padding to give it a bit of space */
            /* border-radius: 5px; */
            /* Same as your button for consistency */
            /* box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2); */
            /* Slight shadow for depth, similar to your blocks */
            /* border: 2px solid whitesmoke; */
            /* Adding a border similar to your color blocks */
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }



        ::selection {
            background-color: coral;
            /* Background color of the selected text */
            color: white;
            /* Text color of the selected text */
        }

        /* For Firefox, you might need to include the following as well */
        ::-moz-selection {
            background-color: coral;
            color: white;
        }

        /* Additional -webkit prefix for Safari */
        ::-webkit-selection {
            background-color: coral;
            color: white;
        }


        /* Enhanced keyframes for the light passing effect */
        @keyframes shineEffect {
            from {
                background-position: -300% 0;
            }

            to {
                background-position: 300% 0;
            }
        }

        #generateColors.processing {
            color: transparent;
            /* Set text color to transparent during processing */
            background: linear-gradient(120deg,
                    coral,
                    transparent,
                    rgba(255, 255, 255, 0.1),
                    rgba(255, 255, 255, 0.5),
                    rgba(255, 255, 255, 0.1),
                    transparent,
                    coral);
            background-size: 300% 100%;
            animation: shineEffect 5s infinite;
            /* Slowed down the animation to 3 seconds */
            cursor: not-allowed;
            -webkit-background-clip: text;
            /* To apply gradient effect only to the text */
            background-clip: text;
        }



        /* Add this to your CSS */
        .button-bar {
            display: flex;
            align-items: center;
            background-color: darkslategray;
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            /* To hide the overflow of the moving overlay */
            z-index: 1;
            /* Making sure this container is above the overlay */

            white-space: nowrap;
        }


        .active-overlay {
            position: absolute;
            height: 100%;
            background-color: coral;
            /* Add width to the transition properties. */
            transition: left 0.3s, width 0.3s;
        }

        .active-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: coral;
            z-index: 1;
            /* Ensures the overlay is beneath the text labels but above the gray background */
        }



        .mode-radio {
            display: none;
        }

        .mode-button {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            color: beige;
            font-size: large;
            cursor: pointer;
            transition: background-color 0.3s;
            position: relative;
            /* Needed to set a z-index */
            z-index: 2;
            /* Ensures the text labels are above the overlay */

        }

        /* Modify the hover effect to work with labels */
        .mode-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Add a new style for checked radio buttons */
        .mode-radio:checked+.mode-button {
            color: beige;
            /* Change color when checked if desired */
        }




        .footer-text {
            color: darkslategray;
            margin-top: 10px;
            margin-bottom: 10px;
            /* font-family: Arial, sans-serif; */
            /* or any other font you're using */
            font-size: 16px;
            text-align: center;
            width: 100%;
            /* position: fixed; */
            /* This will keep the text at the bottom regardless of scroll position */
            bottom: 10px;
            /* Adjust as needed */
            left: 0;
            z-index: 1000;
            /* Ensure the text appears above other content */
            /* background-color: darkslategray; */
            /* color: #FFF; */
        }

        .footer-text a {
            color: coral;
            /* Example blue color for link */
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-text a:hover {
            color: darkslategray;
        }

        .footer-icons img {
            margin-top: 10px;
            width: 24px;
            /* or any size you prefer */
            height: 24px;
            margin-right: 10px;
            /* optional spacing between icons */
        }

        .info-text {
            /* font-family: Arial, sans-serif; */
            /* or any other font you're using */
            font-size: 26px;
            /* Adjust font size as necessary */
            margin-bottom: 20px;
            /* Provide some space between the text and the color block container */
            text-align: center;
            /* Align the text to center, modify if needed */
            color: beige;
            background-color: darkslategray;
            /* Adjust color as needed */
            max-width: 80%;
            /* Makes sure text doesn't stretch too wide on large screens */
            margin-left: auto;
            margin-right: auto;

            min-height: 31px;
        }


        /* Styles for screens smaller than 768px */
        @media (max-width: 768px) {
            .button-bar {
                flex-direction: column;
                /* Change the flex direction to column to stack the children */
            }

            .mode-button {
                width: 100%;
                /* Set the width to 100% of the parent container */
                box-sizing: border-box;
                /* Ensure padding and border are included in the width */
                /* Set a fixed height for the buttons */
                display: flex;
                /* Convert the button labels to flex containers */
                align-items: center;
                /* Vertically center the text inside the button */
                justify-content: center;
                /* Horizontally center the text inside the button */
            }

            .active-overlay {
                width: 100%;
                /* Ensure the overlay takes the full width of the button-bar */
                left: 0;
                /* Reset left to 0 */
                height: calc(100% / 5);
                /* Set the height based on the number of buttons */
                transition: top 0.3s;
                /* Only transition the top property */
            }

            /* Adjust the overlay position based on the checked radio button */
            #NoStream:checked~.active-overlay {
                top: calc(1 * (100% / 5));
                /* Adjust top position based on the button index */
            }

            #StreamObject:checked~.active-overlay {
                top: calc(2 * (100% / 5));
            }

            #StreamObjectKeyValue:checked~.active-overlay {
                top: calc(3 * (100% / 5));
            }

            #StreamObjectKeyValueTokens:checked~.active-overlay {
                top: calc(4 * (100% / 5));
            }



        }


        /* Description */

        .odd-section {
            color: beige;
            background-color: darkslategray;
            width: 100%;
            height: 100%;
            /* If you want it to cover the full viewport height */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .how-to {
            color: beige;
            max-width: 500px;
            font-size: x-large;
            text-align: justify;
            text-justify: inter-word;
            padding: 50px;
            /* background-color: transparent; */
            /* You can remove this line if you want, it's just for clarity */
        }

        .how-to span {
            /* background-color: darkred; */
            background-color: beige;
            color: darkslategray;
        }

        .prompt-function {
            max-width: 500px;
            line-height: 1.5;
        }


        .how-to-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            /* Two equally sized columns */
            gap: 2rem;
            /* Space between grid items */
            max-width: 1200px;
            /* Set max width for the container */
            margin: auto;
            /* Centers the container */

            font-weight: 200;
        }

        .how-to-container strong {
            font-weight: 900;
        }

        .how-to {
            /* ... existing styles ... */
            /* Removing max-width to allow the grid to control the width */
            text-align: justify;
            /* Centers the content */
        }

        .prompt-function {
            /* ... existing styles ... */
            padding: 50px;
            /* Adds some padding around the content for breathing room */
            /* background-color: rgba(255, 255, 255, 0.1); */
            /* Adds a subtle background for better distinction */
            border-radius: 8px;
            /* Rounds the corners */
        }


        @media screen and (max-width: 1024px) {
            .how-to-container {
                grid-template-columns: 1fr;
                /* One column for smaller screens */
            }

            .how-to,
            .prompt-function {
                text-align: left;
                /* Aligns text to the left on small screens */
            }

            pre {
                white-space: pre-wrap;
                /* Allows the content to wrap */
                word-wrap: break-word;
                /* Breaks long words to next line */
            }
        }

        pre {
            /* background-color: #292929; */
            /* background-color: rgb(54, 77, 77); */
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 0px;
            line-height: 1.2;
        }


        /* Installation */

        .even-section {
            background-color: beige;
            color: darkslategray;
            width: 100%;
            height: 100%;
            /* If you want it to cover the full viewport height */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .install-container {
            max-width: 500px;
            font-size: x-large;
            text-align: justify;
            text-justify: inter-word;
            padding: 50px;
        }

        .install-container code {
            background-color: darkslategray;
            color: beige;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        @media screen and (max-width: 1024px) {
            .install-container {
                text-align: left;
                /* Aligns text to the left on small screens */
            }
        }


        /* LINK REPO */
        .repo-link {
            background-color: coral;
            color: white;
            padding: 6px 12px;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .repo-link:hover {
            background-color: #ff6b57;
            /* A slightly darker shade of coral for hover effect */
            transform: translateY(-2px);
            /* Small lift on hover for a dynamic effect */
        }

        .repo-link:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 127, 80, 0.5);
            /* Coral box shadow for accessibility on focus */
        }


        /* code {
            background-color: #292929;
        } */

        /* Styling for the API input textbox */
        .api-input-container {
            margin-bottom: 20px;
            /* Some margin for spacing */
            display: flex;
            /* Using flex to place label and input side-by-side */
            align-items: center;
            /* Vertically aligns the items */
        }

        .api-input-container label {
            margin-right: 10px;
            /* Adds spacing between label and input */
            color: darkslategray;
            /* Color that matches your design */
            font-weight: bold;
            /* To make the label stand out */
        }

        .api-input-container input[type="text"] {
            padding: 10px;
            /* Padding for spacing inside */
            border: 2px solid darkslategray;
            /* Border color that matches your design */
            border-radius: 5px;
            /* Adds some rounded corners to match other elements */
            font-family: 'Roboto', sans-serif;
            /* Using the Roboto font, but adjust if needed */
            font-size: 16px;
            /* Font size similar to other text on your site */
            flex-grow: 1;
            /* Allows the input to take the available space */
            transition: border-color 0.3s;
            /* Smooth transition for hover effect */
        }

        .api-input-container input[type="text"]:focus {
            border-color: coral;
            /* Change border color on focus to indicate active field */
            outline: none;
            /* Removes the default browser outline */
        }

        /* Styling for the counter */
        .counter-container {
            margin-bottom: 20px;
            /* Some margin for spacing */
            display: flex;
            /* Using flex to place label and input side-by-side */
            align-items: center;
            /* Vertically aligns the items */
        }

        .counter-container label {
            margin-right: 10px;
            /* Adds spacing between label and input */
            color: darkslategray;
            /* Color that matches your design */
            font-weight: bold;
            /* To make the label stand out */
        }

        .counter-container input[type="number"] {
            width: 60px;
            /* Set a fixed width for the counter */
            padding: 10px;
            /* Padding for spacing inside */
            border: 2px solid darkslategray;
            /* Border color that matches your design */
            border-radius: 5px;
            /* Adds some rounded corners to match other elements */
            font-family: 'Roboto', sans-serif;
            /* Using the Roboto font, but adjust if needed */
            font-size: 16px;
            /* Font size similar to other text on your site */
            text-align: center;
            /* To center the number in the input box */
            transition: border-color 0.3s;
            /* Smooth transition for hover effect */
        }

        .counter-container input[type="number"]:focus {
            border-color: coral;
            /* Change border color on focus to indicate active field */
            outline: none;
            /* Removes the default browser outline */
        }

        /* Override the appearance for the input type number to make it consistent across browsers */
        .counter-container input[type="number"]::-webkit-inner-spin-button,
        .counter-container input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .counter-container input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>

<body>


    <!-- Make AI apps more interactive and responsive. -->
    <!-- Dive into the next-gen of immersive AI experiences. -->


    <div class="info-text">
    </div>

    <div class="api-input-container">
        <label for="custom-prompt">Describe the tone</label>
        <input type="text" id="custom-prompt" placeholder="Enter your tone..." value="coffee shop in autumn"
            maxlength="100">
    </div>
    <div class="counter-container">
        <label for="counterInput">How many colors?</label>
        <input type="number" id="counterInput" min="1" max="10" value="5" required>
    </div>



    <button id="generateColors">Generate Colors</button>

    <!-- Add this right above your Generate Colors button -->
    <div id="modeSelector" class="button-bar">
        <div class="active-overlay"></div>

        <!-- <input type="radio" name="mode" id="Batch" value="Batch" class="mode-radio">
        <label for="Batch" class="mode-button" data-tooltip="Loads all colors at once.">Batch</label> -->

        <input type="radio" name="mode" id="NoStream" value="NoStream" class="mode-radio">
        <label for="NoStream" class="mode-button" data-tooltip="Loads all colors at once.">All-Together</label>

        <input type="radio" name="mode" id="StreamObject" value="StreamObject" class="mode-radio" checked>
        <label for="StreamObject" class="mode-button" data-tooltip="Loads colors one by one.">One-By-One</label>

        <input type="radio" name="mode" id="StreamObjectKeyValue" value="StreamObjectKeyValue" class="mode-radio">
        <label for="StreamObjectKeyValue" class="mode-button"
            data-tooltip="Loads colors as they're ready.">Progressive</label>

        <input type="radio" name="mode" id="StreamObjectKeyValueTokens" value="StreamObjectKeyValueTokens"
            class="mode-radio">
        <label for="StreamObjectKeyValueTokens" class="mode-button"
            data-tooltip="Loads colors in real-time.">Real-time</label>
        <!-- All together Incremental Progessive Continuous -->

    </div>

    <!-- <div class="voila-style">Tap for AI's Colorful Masterpiece!</div> -->

    <div id="blocksContainer"></div>


    <div id="voilaContainer" class="voila-style">Voila!</div>


    <div id="second-section" class="odd-section">
        <div class="how-to-container">
            <div id="how-to" class="how-to">
                <strong>How AI color generation works</strong><br /><br />
                <!-- <strong>How it works</strong><br /> -->
                We start by sending a <span>prompt to ChatGPT</span>, asking for colors using OpenAI Function Calling.
                In
                response, the API
                sends
                back
                a <span>JSON text stream</span> that isn't fully formatted yet. But here's where the efficiency kicks
                in:
                even
                before we've
                received all of the data, we're already <span>parsing it on-the-fly</span> and turning it into
                structured
                payload entities. And send each of these entities straight to the browser using Server Sent
                Events,
                ensuring a real-time experience.
                <br />
                <br />
                <strong>Modes</strong><br />
                <span>All-Together</span> the UI waits for complete data.<br />
                <span>One-By-One</span> goes object by object.<br />
                <span>Progressive</span> operates via key-value pairs.<br />
                <span>Real-time</span> feeds data by individual tokens.<br />

            </div>

            <div id="prompt-function" class="prompt-function">
                <strong>The Prompt</strong><br />
                <code>
                Give me a palette of 5 gorgeous colors with their hex codes, names, and descriptions.
                </code>
                <br />
                <br />
                <strong>The Function</strong>
                <pre><code>name: give_colors
description: Give a list of colors
parameters:
  type: object
  properties:
    colors:
      type: array
      items:
        type: object
        properties:
          hex:
            type: string
            description: The hexadecimal code of the color
          name:
            type: string
            description: The color name
          description:
            type: string
            description: The description of the color</code></pre>
                <!-- <br /> -->
                <!-- <br /> -->
                <strong>The raw stream of tokens</strong>
                <pre><code>data: {"he
data: x":"#FF
data: 69B4"
data: ,"na
data: me":"Ho
data: t Pink"</code></pre>
                <strong>The parsable entity stream </strong>
                <pre><code>{ "index": 0, "status": "PARTIAL",
"data": { "hex": "#FF69B4", "name": "Hot Pink" },
"entity": "colors" }</code></pre>

            </div>
        </div>

    </div>

    <div id="installation-section" class="even-section">
        <div class="install-container">
            <strong>Installation</strong><br /><br />
            To get started with JavaScript / TypeScript:
            <br /><br />
            <code>npm i openai-partial-stream</code>
            <br /><br />
            Import, and you'll want the manual, check out the <a href="https://github.com/st3w4r/openai-partial-stream"
                target="_blank" rel="noopener noreferrer" class="repo-link">documentation on GitHub</a>

        </div>
    </div>




    <div class="footer-text">
        Stepping into the arena with <a href="https://github.com/st3w4r/openai-partial-stream" target="_blank"
            rel="noopener noreferrer">Partial-Stream</a>
        and ChatGPT API function calling.

        <div class="footer-icons">
            <a href="https://twitter.com/YanaelBarbier" target="_blank" rel="noopener noreferrer">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/X_logo_2023_original.svg/600px-X_logo_2023_original.svg.png"
                    alt="X/Twitter" />
            </a>
            <a href="https://www.threads.net/@yanaelbarbier" target="_blank" rel="noopener noreferrer">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Threads_%28app%29_logo.svg/1024px-Threads_%28app%29_logo.svg.png?20230705004747"
                    alt="Threads" />
            </a>
            <a href="https://github.com/st3w4r/openai-partial-stream" target="_blank" rel="noopener noreferrer">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" alt="GitHub">
                    <path
                        d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                </svg>
            </a>
        </div>
    </div>



    <script type="module">

        const baseURL = "https://colors.st3w4r.workers.dev/api"

        let blocks = [];
        let colorBlocks = [];
        let copiedColors = [];  // To maintain a list of copied colors

        function clearBlocks() {
            const container = document.getElementById('blocksContainer');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            blocks = [];
            document.getElementById('voilaContainer').style.opacity = "0";
        }

        let firstTimeDisplayed = false;
        let startTime;

        function callGenerateColors() {
            const btn = document.getElementById('generateColors');

            // Fetch the value from the custom-prompt input box
            const promptValue = encodeURIComponent(document.getElementById('custom-prompt').value);
            // Fetch the value from the counter input box
            const numberValue = document.getElementById('counterInput').value;


            // Check timer
            firstTimeDisplayed = false;
            startTime = new Date();


            // Change the button text to "Processing..." and disable it
            btn.textContent = "Streaming Colors";
            // btn.textContent = "Generate Colors";
            btn.disabled = true;
            btn.classList.add("processing");

            clearBlocks();

            // Retrieve the selected mode:
            const selectedMode = document.querySelector('input[name="mode"]:checked').value;

            console.log("selected mode", selectedMode);
            // OR
            // const selectedMode = document.querySelector('.mode-radio:checked').value;


            // Connect to the SSE endpoint using the selected mode:
            const eventSource = new EventSource(`${baseURL}/sse/colors?mode=${selectedMode}&prompt=${promptValue}&number=${numberValue}`);


            eventSource.onmessage = function (event) {
                // Parse the data from the SSE message
                const data = JSON.parse(event.data);

                if (!firstTimeDisplayed && data && Object.keys(data.data).length !== 0) {
                    const elapsedTime = new Date() - startTime;
                    const elapsedSeconds = (elapsedTime / 1000).toFixed(2); // Convert to seconds and keep 2 decimal places
                    const voilaContainer = document.getElementById('voilaContainer');

                    // Update the text of the voilaContainer with the elapsed time in seconds
                    voilaContainer.textContent = `Kick-off ${elapsedSeconds} seconds.`;

                    firstTimeDisplayed = true;
                }


                if (data.status === 'PARTIAL' || data.status === 'COMPLETED') {
                    processBlock(data.index, data.data);
                } else if (data.status === 'ERROR') {
                    console.error('Error occurred:', data);
                }
            };

            eventSource.onerror = function (event) {
                console.error('Error occurred:', event);
                eventSource.close();

                // Extract the error message from the event
                const data = event?.data;
                if (data) {
                    const dataObj = JSON.parse(data);
                    if (dataObj?.error) {
                        // Display the error code and message
                        console.error(`Error ${dataObj.error.code}: ${dataObj.error.message}`);
                    }
                }

                // Error
                btn.textContent = "Oops! Retry a bit later";
                btn.disabled = false;
                btn.classList.remove("processing");
            };

            eventSource.addEventListener('CLOSE', function (e) {
                console.log(e.data);  // "Closing connection"
                eventSource.close();  // Close the connection from the client side

                // Reset the button to its original state
                btn.textContent = "Generate Colors";
                btn.disabled = false;
                btn.classList.remove("processing");
                document.getElementById('voilaContainer').style.opacity = "1";
            });
        }


        document.getElementById('generateColors').addEventListener('click', () => callGenerateColors());


        function processBlock(index, data) {
            // Check if the current mode is NoStream and handle the list
            const selectedMode = document.querySelector('input[name="mode"]:checked').value;
            if (selectedMode === 'Batch' && Array.isArray(data)) {
                data.forEach((item, idx) => {
                    processSingleBlock(idx, item);
                });
            } else {
                processSingleBlock(index, data);
            }
        }

        function processSingleBlock(index, data) {
            if (!blocks[index]) {

                if (data.hex) {
                    colorBlocks[index] = data.hex;
                }

                // Move all existing blocks to make space for the new one
                // Object.values(blocks).forEach(block => {
                //     const currentLeft = parseInt(getComputedStyle(block).left, 10);
                //     block.style.left = (currentLeft - 10) + 'px';  // assuming each block is 240px wide
                // });

                // Block does not exist; create it
                const block = document.createElement('div');
                block.className = 'color-block';
                // block.style.backgroundColor = data.hex || '#FFFFFF';  // Default to white if hex isn't provided
                block.style.backgroundColor = data.hex || 'beige';  // Default to white if hex isn't provided
                //             block.innerHTML = `
                //     <span class="color-name">${data.name || ''}</span>
                //     <span class="color-description">${data.description || ''}</span>
                // `;
                block.innerHTML = `
                        <div class="color-content">
                            <span class="color-name">${data.name || ''}</span>
                            <span class="color-description">${data.description || ''}</span>
                        </div>
                    `;


                block.style.opacity = 0;  // Initially set to 0
                document.getElementById('blocksContainer').appendChild(block);
                blocks[index] = block;


                // Add click event to copy the hex code
                block.addEventListener('click', function () {
                    const hexCode = colorBlocks[index];
                    const colorNameElement = block.querySelector('.color-name');
                    const colorDescriptionElement = block.querySelector('.color-description');
                    const originalNameText = colorNameElement.getAttribute('data-original') || colorNameElement.textContent;
                    const originalDescriptionText = colorDescriptionElement.getAttribute('data-original') || colorDescriptionElement.textContent;

                    // Check if color is already copied
                    if (copiedColors.includes(hexCode)) {
                        // Color was previously copied; remove it
                        copiedColors = copiedColors.filter(color => color !== hexCode);
                        // Revert the texts back to original
                        colorNameElement.textContent = originalNameText;
                        colorDescriptionElement.textContent = originalDescriptionText;
                    } else {
                        // Color was not copied before; add it
                        copiedColors.push(hexCode);
                        // Store original texts in 'data-original' attributes for future use
                        colorNameElement.setAttribute('data-original', originalNameText);
                        colorDescriptionElement.setAttribute('data-original', originalDescriptionText);
                        // Set new texts
                        colorNameElement.textContent = 'COPIED';
                        colorDescriptionElement.textContent = hexCode;
                    }

                    // Update the clipboard with the list of copied colors
                    navigator.clipboard.writeText(copiedColors.join('\n')).then(() => {
                        console.log('Clipboard updated with copied colors');
                    }, (err) => {
                        console.error('Could not update clipboard: ', err);
                    });
                });



                // Delay to let the block be added to the DOM, then fade in.
                setTimeout(() => {
                    block.style.opacity = 1;
                }, 50);
            } else {
                // Block exists; update it
                colorBlocks[index] = data.hex;

                const block = blocks[index];
                if (data.hex) block.style.backgroundColor = data.hex;
                if (data.name) block.querySelector('.color-name').textContent = data.name;
                if (data.description) block.querySelector('.color-description').textContent = data.description;
            }
        }



        function adjustOverlayPosition(clickedButton = null) {
            const overlay = document.querySelector('.active-overlay');
            const buttonToUse = clickedButton || document.querySelector('.mode-radio:checked + .mode-button');

            if (!buttonToUse) return; // Exit if no button is checked or provided

            // Check if the screen width is larger than 768px
            if (window.innerWidth > 768) {
                overlay.style.left = `${buttonToUse.offsetLeft}px`;  // Set overlay to start at the button's left offset.
                overlay.style.width = `${buttonToUse.offsetWidth}px`;  // Set overlay width to match the button's width.
                overlay.style.top = ""; // Clear the top style
                overlay.style.height = ""; // Clear the height style
            } else {
                overlay.style.top = `${buttonToUse.offsetTop}px`;  // Set overlay to start at the button's top offset.
                overlay.style.height = `${buttonToUse.offsetHeight}px`;  // Set overlay height to match the button's height.
                overlay.style.left = ""; // Clear the left and width styles
                overlay.style.width = "";
            }
        }


        // Add event listeners to the mode buttons
        document.querySelectorAll('.mode-button').forEach((btn) => {
            btn.addEventListener('click', () => adjustOverlayPosition(btn));
        });


        // Initialize the overlay's position and width to match the default checked button
        document.addEventListener('DOMContentLoaded', () => {
            // Add this new code to adjust the overlay based on the checked radio button
            const checkedButton = document.querySelector('.mode-radio:checked + .mode-button');
            if (checkedButton) {
                const overlay = document.querySelector('.active-overlay');
                overlay.style.left = `${checkedButton.offsetLeft}px`;
                overlay.style.width = `${checkedButton.offsetWidth}px`;
            }

            // Fetch the tagline content
            listenForTaglineUpdates();

            // Adjust overlay position based on the initial state
            adjustOverlayPosition();
        });

        function listenForTaglineUpdates() {
            const eventSource = new EventSource(`${baseURL}/sse/tagline`);

            eventSource.onmessage = function (event) {
                const data = JSON.parse(event.data);
                if (data.data && data.data.tagline) {
                    const infoTextElement = document.querySelector('.info-text');
                    if (infoTextElement) {
                        infoTextElement.textContent = data.data.tagline;
                    }
                }
            };

            eventSource.addEventListener('CLOSE', function (e) {
                console.log(e.data);  // "Closing connection"
                eventSource.close();

            })

            eventSource.onerror = function (event) {
                console.error('Error occurred:', event);
                eventSource.close();
            };
        }


        document.addEventListener("DOMContentLoaded", function () {
            // This ensures the script runs after the page's DOM is fully loaded

            const sentences = [
                "Wine in France",
                "Coffee shop in autumn",
                "Sunset lover",
                "Mother nature",
                "Aurora borealis",
                "Midnight with the stars",
            ];

            const randomSentence = sentences[Math.floor(Math.random() * sentences.length)];

            document.getElementById('custom-prompt').value = randomSentence;
        });



    </script>

</body>

</html>
